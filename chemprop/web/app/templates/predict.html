{% extends "layout.html" %}
{% from 'macros.html' import add_checkpoint, chemdraw, error_message, warning_message %}

{% block title %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMET-AI Prediction</title>
    <style>
        

        #cont1 {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 36px;
            margin-bottom: 10px;
            color: #333;
        }

        h3 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #555;
        }

        p {
            font-size: 16px;
            line-height: 1.6;
            color: #777;
        }

        a {
            color: #007bff;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container" id="cont1">
        <h1>ADMET-AI Prediction</h1>
        <h3>Information</h3>
        <p>
            Explanation about Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore 
            et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut 
            aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum 
            dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia 
            deserunt mollit anim id est laborum.
        </p>
        <p>
            ADMET-AI is still in beta testing mode, more improvements and a paper will come out later
        </p>
        <p> Chemprop <a href="https://github.com/chemprop/chemprop"> Code</a> and <a href="https://pubs.acs.org/doi/full/10.1021/acs.jcim.9b00237"> Paper</a>.</p>
        <p>  <a href="https://www.cell.com/cell/fulltext/S0092-8674(20)30102-1"> Antibiotics</a> and <a href="https://tdcommons.ai/"> TDC</a> Information.</p>

    </div>
</body>

{% endblock %}



{% block content %}
<body>
    <div class="container" id="cont1">
        <style>
            body {
                background-image: url('../static/images/icon_faded.png');
                background-size: cover;
                background-repeat: no-repeat;
                background-attachment: fixed;
            }
        </style>

        {% if not config['DEMO'] and config['ALLOW_CHECKPOINT_UPLOAD'] %}
        {{ add_checkpoint('predict', checkpoint_upload_warnings, checkpoint_upload_errors) }}
        <hr>

        
        {% endif %}
        

        {% if max_molecules %}
            <p>Note: Predictions can be made for at most {{ max_molecules }} molecules at a time.</p>
        {% endif %}

        <form enctype="multipart/form-data" method="POST">
    {#        <!--Model checkpoint selector-->#}
    {#        <h5>Model checkpoint</h5>#}
    {#        <select name="checkpointName" required>#}
    {#            {% for checkpoint in checkpoints %}#}
    {#                <option value="{{ checkpoint[0] }}">{{ checkpoint[1] }}</option>#}
    {#            {% endfor %}#}
    {#        </select>#}
    {##}
    {#        <br>#}
    {#        <br>#}

            <!--SMILES upload type selector-->
            <div class="btn-group" id="inputSelect" data-toggle="buttons">
                <label id="textButton" class="btn btn-primary active">
                <input type="radio" name="inputType" value="text" autocomplete="off"> Text Input
                </label>
                <label id="fileButton" class="btn btn-primary">
                <input type="radio" name="inputType" value="file" autocomplete="off"> Upload File
                </label>
                <label id="drawButton" class="btn btn-primary">
                <input type="radio" name="inputType" value="file" autocomplete="off"> Draw Molecule
                </label>
            </div>

            <br>

            <!--SMILES input-->
            <div id="textInputForm">
                <h5>SMILES (one per line)</h5>
                <textarea id="textSmilesInput" name="textSmiles" cols="100" rows="10" placeholder="SMILES" required></textarea>
            </div>
            <div id="fileInputForm" style="display:none">
                <h5>File containing SMILES (one per line)</h5>
                <input id="fileSmilesInput" type="file" name="data" accept=".csv">
            </div>
            <div id="drawInputForm" style="display:none">
                <h5>Draw a molecule</h5>
                {{ chemdraw() }}
                <br>
                <button type="button" id="convertToSmiles" class="btn btn-primary btn-xs">Convert to SMILES</button>
                <input id="drawSmilesInput" name="drawSmiles" placeholder="SMILES">
            </div>

            <br>

            <!--SMILES input functionality-->
            <script>
                $(document).ready(function() {
                    $(document).ready(function() {
                        $("#textButton").click(function() {
                            $("#textInputForm").show();
                            $("#textSmilesInput").prop('required', true);
                            $("#fileInputForm").hide();
                            $("#fileSmilesInput").prop('required', false);
                            $("#drawInputForm").hide();
                            $("#drawSmilesInput").prop('required', false);
                            $("#drawSmilesInput").val('');
                        });
                        $("#fileButton").click(function() {
                            $("#textInputForm").hide();
                            $("#textSmilesInput").prop('required', false);
                            $("#textSmilesInput").val('');
                            $("#fileInputForm").show();
                            $("#fileSmilesInput").prop('required', true);
                            $("#drawInputForm").hide();
                            $("#drawSmilesInput").prop('required', false);
                            $("#drawSmilesInput").val('');
                        });
                        $("#drawButton").click(function() {
                            $("#textInputForm").hide();
                            $("#textSmilesInput").prop('required', false);
                            $("#textSmilesInput").val('');
                            $("#fileInputForm").hide();
                            $("#fileSmilesInput").prop('required', false);
                            $("#drawInputForm").show();
                            $("#drawSmilesInput").prop('required', true);
                        });
                    });

                    $("#convertToSmiles").click(function() {
                        $("#drawSmilesInput").val(jsmeApplet.smiles());
                    });
                });
            </script>
            <!--GPU selector-->
            {% if cuda %}
                <h5>GPU</h5>
                <select name="gpu">
                    <option value="None">None</option>
                    {% for gpu in gpus %}
                        <option value="{{ gpu }}">{{ gpu }}</option>
                    {% endfor %}
                </select>
                <br>
                <br>
            {% endif %}

            <button type="submit" class="btn btn-primary btn-md">Predict</button>
        </form>

        <br>

        {% if warnings %}
            {% for warning in warnings %}
                {{ warning_message(warning) }}
            {% endfor %}
        {% endif %}

        {% if errors %}
            {% for error in errors %}
                {{ error_message(error) }}
            {% endfor %}
        {% endif %}


        <div class="dropdown">
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                Select ATC Code
            </button>
            <div class="dropdown-menu">
                <input class="form-control" id="atc-selection" type="text" placeholder="Search..">
                <li>
                    {% for atc_code in drugbank_atc_codes %}
                        <a class="dropdown-item" href="#">{{ atc_code }}</a>
                    {% endfor %}
                </li>
            </div>
        </div>
        <script>
        $(document).ready(function(){
            $("#atc-selection").on("keyup", function() {
                var value = $(this).val().toLowerCase();
                $(".dropdown-menu li a").filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });

            function clickATC(atc_code) {
                $.ajax({
                    url: "/drugbank_plot?atc_code=" + atc_code,
                    type: "GET",
                    dataType: "json",
                    success: function(response) {
                        if (response.svg) {
                            document.getElementById("drugbank-plot").innerHTML = response.svg;
                        }
                    },
                    error: function(error) {
                        console.error("Failed to fetch DrugBank SVG:", error);
                    }
                });
            }

            $('.dropdown-menu li a').click(function() {
                var selectedValue = $(this).text();
                clickATC(selectedValue);
            });
        });
        </script>

        <br>
        <br>

        <div id="drugbank-plot" style="flex: 1; width: 100%;">
            {{ drugbank_plot|safe }}
        </div>

        

        {% if predicted %}
            <hr>

            <a href="{{ url_for('download_predictions') }}"><button class="btn btn-default btn-md">Download Results</button></a>

            

            <!-- UNFINISHED: Sort Function -->
            <!-- <button class="btn btn-default btn-md" onclick="SortData()">
                Sort Predictions
            </button>
              
            <script>
                function comparator(a, b) {
                    if (a.dataset.index < b.dataset.index)
                        return -1;
                    if (a.dataset.index > b.dataset.index)
                        return 1;
                    return 0;
                }
                  
                // Function to sort Data
                function SortData() {
                    var indexes = document.querySelectorAll("[data-index]");
                    var indexesArray = Array.from(indexes);
                    let sorted = indexesArray.sort(comparator);
                    sorted.forEach(e =>
                        document.querySelector("#list").appendChild(e));
                }
            </script>   -->

            <br>
            <br>

            <style>
                /* Add styles for the table */
                table {
                    min-width: 300px;
                    /* width: 30%;  */
                    border-collapse: collapse;
                    background-color: #f2f2f2;
                }

                th, td {
                    padding: 4px; /* Adjust the padding as needed */
                    border: 1px solid #dddddd;
                    text-align: center;
                    font-size: 12px; /* Adjust the font size as needed */
                }

                th {
                    background-color: #12272b;
                    color: white;
                }

                /* CSS for  image container */
                .mol-image {
                    display: inline-block;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    padding: 5px;
                    margin-left: 10px;
                    background-color: #f8f4f4;
                    float:right; 
                }

                .mol-image2 {
                    display: inline-block;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    padding: 5px;
                    margin-left: 10px;
                    background-color: #f8f4f4;
                }

                .collapse {
                    /* background-color: #d01212;  */
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    padding: 15px;
                }

                .btn-link2 {
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    /* padding: 15px; */
                    width: 100%;
                    text-align: left;
                    padding-top: 10px; 
                    padding-bottom: 10px;
                    padding-right: 15px;
                    padding-left: 15px;
                    background-color: #d0ece4;
                    /* color: #007bff; */
                    text-decoration: none;
                }

                .btn-link2:hover {
                    text-decoration: underline;
                }

                ul {
                    list-style-type: none;
                    margin: 0;
                    padding: 0;
                }

            </style>
            
            <!-- <label for="models">Select Model for Sorting:</label>
            <select name="models" id="models">
                <option value="0">ClinTox</option>
                <option value="1">Test</option>
                <option value="2">Placeholder</option>
                
            </select> -->

  

            <ul id="list">
                    {% for smiles_index in range(num_smiles) %}
                    
                    <li class="index" data-index="{{ '%0.4f'|format(preds[smiles_index][0]) }}">
                        <div>
                            <button id="collapseButton{{ smiles_index }}" class="btn btn-link2" type="button" data-toggle="collapse" data-target="#collapseInfo{{ smiles_index }}" aria-expanded="false" aria-controls="collapseInfo{{ smiles_index }}">
                                <strong>Molecule {{ smiles_index + 1 }}: {{ smiles[smiles_index] }}  </strong>
                                <div id="molecule-image{{ smiles_index }}" class="mol-image"></div>
                            </button>
                        </div>

                        <div id="collapseInfo{{ smiles_index }}" class="collapse">
                            <!-- Display PubChem link and molecule image here -->
                            <!-- <br> -->
                            <!-- <strong>SMILES:</strong> {{ smiles[smiles_index] }}
                            <br>
                            <br> -->
                            <div id="pubchem-link{{ smiles_index }}"></div>
                            <!-- <br>
                            
                            <br> -->
                            <br>

                            {% set prop_units = ['kJ/mol', '%', 'log(cm/s)', 'log-ratio', '%', 'log(mol/L)', 'L/kg', '%', '%', 
                            '%', '%', '%', '%', '%', '%', '%', '%', 'hr', 'uL min^-1 (106 cells)^-1', 'mL min^-1 g^-1', 
                            '-log(mol/kg)', '%', '%', '%', '%', '%', '%', '%', '%', '%', '%'] %}
                                                        
                            {% set adsorption_list = ['Bioavailability_Ma', 'Caco2_Wang', 'HIA_Hou', 'HydrationFreeEnergy_FreeSolv', 
                            'Lipophilicity_AstraZeneca', 'PAMPA_NCATS' 'Pgp_Broccatelli', 'Solubility_AqSolDB'] %}

                            {% set adsorption_names = ['Bioavailability', 'Cell Effective Permeability', 'Human Intestinal Adsorption',
                            'Hydration Free Energy', 'Lipophilicity', 'PAMPA Permeability' 'P-glycoprotein Inhibition', 'Solubility'] %}

                            {% set adsorption_urls = [
                                'https://tdcommons.ai/single_pred_tasks/adme/#bioavailability-ma-et-al',
                                'https://tdcommons.ai/single_pred_tasks/adme/#caco-2-cell-effective-permeability-wang-et-al',
                                'https://tdcommons.ai/single_pred_tasks/adme/#hia-human-intestinal-absorption-hou-et-al',
                                'https://tdcommons.ai/single_pred_tasks/adme/#hydration-free-energy-freesolv',
                                'https://tdcommons.ai/single_pred_tasks/adme/#lipophilicity-astrazeneca',
                                'https://tdcommons.ai/single_pred_tasks/adme/#pampa-permeability-ncats',
                                'https://tdcommons.ai/single_pred_tasks/adme/#pgp-p-glycoprotein-inhibition-broccatelli-et-al',
                                'https://tdcommons.ai/single_pred_tasks/adme/#solubility-aqsoldb'
                                ] %}

                            {% set adsorption_multitask_values = [
                                0.8982852555,
                                0.744364201, 
                                0.9966067076,
                                0.9192450003, 
                                0.7460474618, 
                                0.9482661503, 
                                0.959242927, 
                                0.8142766273 
                                ] %}

                            {% set adsorption_size = [
                                640,
                                906,
                                578,
                                642,
                                4200,
                                2034,
                                1212,
                                9982
                                ] %}

                            {% set distribution_list = ['BBB_Martins', 'PPBR_AZ', 'VDss_Lombardo'] %}

                            {% set distribution_names = ['Blood Brain Barrier', 'Plasma Protein Binding Rate', 'Volumn of Distribution at steady state'] %}

                            {% set distribution_urls = [
                                'https://tdcommons.ai/single_pred_tasks/adme/#bbb-blood-brain-barrier-martins-et-al',
                                'https://tdcommons.ai/single_pred_tasks/adme/#ppbr-plasma-protein-binding-rate-astrazeneca',
                                'https://tdcommons.ai/single_pred_tasks/adme/#vdss-volumn-of-distribution-at-steady-state-lombardo-et-al'
                                ] %}

                            {% set distribution_multitask_values = [
                                0.9780836093, 
                                0.4620890511, 
                                -0.6101450267 
                                ] %}

                            {% set distribution_size = [
                                1975,
                                1614,
                                1111
                                ] %}

                            {% set metabolism_list = ['CYP1A2_Veith', 'CYP2C9_Substrate_CarbonMangels', 'CYP2C9_Veith', 'CYP2C19_Veith', 
                            'CYP2D6_Substrate_CarbonMangels', 'CYP2D6_Veith', 'CYP3A4_Substrate_CarbonMangels', 'CYP3A4_Veith'] %}

                            {% set metabolism_names = ['CYP1A2 Inhibition', 'CYP2C9 Substrate', 'CYP2C9 Inhibition', 'CYP2C19 Inhibition', 
                            'CYP2D6 Substrate', 'CYP2D6 Inhibition', 'CYP3A4 Substrate', 'CYP3A4 Inhibition'] %}

                            {% set metabolism_urls = [
                                'https://tdcommons.ai/single_pred_tasks/adme/#cyp-p450-1a2-inhibition-veith-et-al',
                                'https://tdcommons.ai/single_pred_tasks/adme/#cyp2c9-substrate-carbon-mangels-et-al',
                                'https://tdcommons.ai/single_pred_tasks/adme/#cyp-p450-2c9-inhibition-veith-et-al',
                                'https://tdcommons.ai/single_pred_tasks/adme/#cyp-p450-2c19-inhibition-veith-et-al',
                                'https://tdcommons.ai/single_pred_tasks/adme/#cyp2d6-substrate-carbon-mangels-et-al',
                                'https://tdcommons.ai/single_pred_tasks/adme/#cyp-p450-2d6-inhibition-veith-et-al',
                                'https://tdcommons.ai/single_pred_tasks/adme/#cyp3a4-substrate-carbon-mangels-et-al',
                                'https://tdcommons.ai/single_pred_tasks/adme/#cyp-p450-3a4-inhibition-veith-et-al'
                                ] %}

                            {% set metabolism_multitask_values = [
                                0.934630479, 
                                0.3002083, 
                                0.8090113784, 
                                0.8823827106, 
                                0.5738635639, 
                                0.7342224231, 
                                0.7014175322, 
                                0.8815952572 
                                ] %}

                            {% set metabolism_size = [
                                12579,
                                666,
                                12092,
                                12665,
                                664,
                                13130,
                                667,
                                12328
                                ] %}

                            {% set excretion_list = ['Clearance_Hepatocyte_AZ', 'Clearance_Microsome_AZ', 'Half_Life_Obach'] %}
                            
                            {% set excretion_names = ['Clearance (Hepatocyte)', 'Clearance (Microsome)', 'Half_Life'] %}

                            {% set excretion_urls = [
                                'https://tdcommons.ai/single_pred_tasks/adme/#clearance-astrazeneca',
                                'https://tdcommons.ai/single_pred_tasks/adme/#clearance-astrazeneca',
                                'https://tdcommons.ai/single_pred_tasks/adme/#half-life-obach-et-al'
                                ] %}

                            {% set excretion_multitask_values = [
                                0.3022337749, 
                                0.3003254935, 
                                -1.551572848 
                                ] %}

                            {% set excretion_size = [
                                1020,
                                1102,
                                665
                                ] %}

                            {% set toxicity_list = ['ClinTox', 'AMES', 'Carcinogens_Lagunin', 'DILI', 'hERG_Karim', 'LD50_Zhu', 'Skin Reaction'] %}

                            {% set toxicity_names = ['ClinTox', 'Ames Mutagenicity', 'Carcinogens', 'Drug Induced Liver Injury', 'hERG Karim', 'Acute Toxicity LD50', 'Skin Reaction'] %}

                            {% set toxicity_urls = [
                                'https://tdcommons.ai/single_pred_tasks/tox/#clintox',
                                'https://tdcommons.ai/single_pred_tasks/tox/#ames-mutagenicity',
                                'https://tdcommons.ai/single_pred_tasks/tox/#carcinogens',
                                'https://tdcommons.ai/single_pred_tasks/tox/#dili-drug-induced-liver-injury',
                                'https://tdcommons.ai/single_pred_tasks/tox/#herg-karim-et-al',
                                'https://tdcommons.ai/single_pred_tasks/tox/#acute-toxicity-ld50',
                                'https://tdcommons.ai/single_pred_tasks/tox/#skin-reaction'
                                ] %}

                            {% set toxicity_multitask_values = [
                                0.4253902419, 
                                0.9122659883,
                                0.7284862154,
                                0.8583792768, 
                                0.9259686215, 
                                0.6125000012, 
                                0.8673169073 
                                ] %}

                            {% set toxicity_size = [
                                1459,
                                7255,
                                278,
                                475,
                                648,
                                7342,
                                404
                                ] %}
                            
                            {% set counter = namespace(value=0) %}

                            {% set ranges = ['N/A', 'N/A', 'Optimal: >-5.15', 'Optimal: 1-3', 'Optimal: >=80%', 'Optimal: Soluble -20, slightly soluble -4-2, insoluble <-4', 'Optimal: 0.04~20', 'Optimal: <= 30%', 'Optimal: <= 90%', 'N/A', 'N/A', 'N/A', 'N/A', 'N/A', 'N/A', 'N/A', 'N/A', 'N/A', 'N/A', 'N/A', 'N/A', 'N/A', 'Optimal: <=30%', 'N/A', 'Optimal: <= 30%', 'Optimal: <= 30%', 'N/A', 'N/A', 'N/A', 'N/A', 'N/A'] %}
                            
                            <div style="display: flex; flex-wrap: wrap;">
                                

                                <style>
                                    .table_header {
                                        color: #007bff
                                    }
                                    .data_link {
                                        color: black
                                    }
                                </style>
                                
                                <!-- <div style="flex: 1; width: 100%;">
                                    <div id="molecule-image2{{ smiles_index }}" class="mol-image2"></div>
                                </div> -->

                                <div style="flex: 1; width: 100%;">
                                    <h3 id="table_header">Absorption</h3>
                                    <table style="width: 90%; margin: 10px;">
                                        <thead>
                                            <tr>
                                                <th>Model</th>
                                                <th>Prediction</th>
                                                <th>DrugBank Percentile</th>
                                                <th>Unit</th>
                                               
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for j in range(num_tasks) %}
                                                {% if task_names[j] in adsorption_list %}

                                                    <tr>
                                                        <td><strong>
                                                            <a href={{ adsorption_urls[adsorption_list.index(task_names[j])] }} class="data_link">
                                                                {{ adsorption_names[adsorption_list.index(task_names[j])] }}
                                                            </a>
                                                            <span 
                                                                class="glyphicon glyphicon-question-sign" 
                                                                style="font-size:15px" data-toggle="tooltip" 
                                                                data-placement="right" 
                                                                title="Dataset R^2 mean: {{ '%0.4g'|format(adsorption_multitask_values[adsorption_list.index(task_names[j])]) }}          
                                                                Dataset Size: {{ '%0.4g'|format(adsorption_size[adsorption_list.index(task_names[j])]) }}">
                                                            </span>    
                                                        </strong></td>                                                        
                                                        {% if task_names[j] == 'Lipophilicity_AstraZeneca' %}
                                                            {% if preds[smiles_index][j] >= -5.15 %}

                                                                <td style="background-color:#8dec9c">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if adsorption_multitask_values[adsorption_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            
                                                            {% else %}
                                                                <td style="background-color:#e68484">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if adsorption_multitask_values[adsorption_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            {% endif %}
                                                        {% elif task_names[j] == 'Solubility_AqSolDB' %}
                                                            {% if preds[smiles_index][j] <= 3 and preds[smiles_index][j] >= 1 %}

                                                                <td style="background-color:#8dec9c">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if adsorption_multitask_values[adsorption_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            
                                                            {% else %}
                                                                <td style="background-color:#e68484">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if adsorption_multitask_values[adsorption_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            {% endif %}
                                                        {% elif task_names[j] == 'Bioavailability_Ma' %}
                                                            {% if preds[smiles_index][j] >= 80 %}

                                                                <td style="background-color:#8dec9c">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if adsorption_multitask_values[adsorption_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            
                                                            {% else %}
                                                                <td style="background-color:#e68484">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if adsorption_multitask_values[adsorption_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            {% endif %}
                                                        {% elif task_names[j] == 'HIA_Hou' %}
                                                            {% if preds[smiles_index][j] < -4 %}

                                                                <td style="background-color:#8dec9c">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if adsorption_multitask_values[adsorption_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            {% elif preds[smiles_index][j] >= -4 and preds[smiles_index][j] >= 2  %}
                                                                <td style="background-color:#dfec8d">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if adsorption_multitask_values[adsorption_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            {% else %}
                                                                <td style="background-color:#e68484">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if adsorption_multitask_values[adsorption_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            {% endif %}
                                                        {% else %}
                                                            <td>
                                                                {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                {% if ranges[counter.value] != 'N/A' %} 
                                                                    <span 
                                                                        class="glyphicon glyphicon-exclamation-sign" 
                                                                        style="font-size:15px" data-toggle="tooltip" 
                                                                        data-placement="right" 
                                                                        title="{{ ranges[counter.value] }}">
                                                                    </span>
                                                                {% endif %}
                                                                {% if adsorption_multitask_values[adsorption_list.index(task_names[j])] < 0.6 %}
                                                                    <span 
                                                                        class="glyphicon glyphicon-warning-sign" 
                                                                        style="font-size:15px" data-toggle="tooltip" 
                                                                        data-placement="right" 
                                                                        title="Lower accuracy">
                                                                    </span>
                                                                {% endif %}
                                                            </td>

                                                        {% endif %}
                                                        <td>
                                                            {{ '%0.2f'|format(drugbank_percentiles[smiles_index][j]) }}%
                                                        <td>
                                                            {{ prop_units[counter.value] }}
                                                            {% set counter.value = counter.value + 1 %}
                                                        </td>
                                                        
                                                    </tr>
                                                    
                                                {% endif %}
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div style="flex: 1; width: 100%;">
                                    <h3 id="table_header">Distribution</h3>
                                    <table style="width: 90%; margin: 10px;">
                                        <thead>
                                            <tr>
                                                <th>Model</th>
                                                <th>Prediction</th>
                                                <th>DrugBank Percentile</th>
                                                <th>Unit</th>
                                                
                                            </tr>
                                        </thead>
                                        <tbody>
                                          
                                            {% for j in range(num_tasks) %}
                                                {% if task_names[j] in distribution_list %}
                                                   
                                                    <tr>
                                                        
                                                        <td><strong>
                                                            <a href={{ distribution_urls[distribution_list.index(task_names[j])] }} class="data_link">
                                                                {{ distribution_names[distribution_list.index(task_names[j])] }}
                                                            </a>
                                                            <span 
                                                                class="glyphicon glyphicon-question-sign" 
                                                                style="font-size:15px" data-toggle="tooltip" 
                                                                data-placement="right" 
                                                                title="Dataset R^2 mean: {{ '%0.4g'|format(distribution_multitask_values[distribution_list.index(task_names[j])]) }}          
                                                                Dataset Size: {{ '%0.4g'|format(distribution_size[distribution_list.index(task_names[j])]) }}">
                                                            </span>     
                                                        </strong></td>
                                                        
                                                        {% if task_names[j] == 'BBB_Martins' %}
                                                            {% if preds[smiles_index][j] <= 0.9 %}

                                                                <td style="background-color:#8dec9c">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if distribution_multitask_values[distribution_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            
                                                            {% else %}
                                                                <td style="background-color:#e68484">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if distribution_multitask_values[distribution_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            {% endif %}
                                                        {% elif task_names[j] == 'PPBR_AZ' %}
                                                            {% if preds[smiles_index][j] <= 21 and preds[smiles_index][j] >= 0.04 %}

                                                                <td style="background-color:#8dec9c">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if distribution_multitask_values[distribution_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            
                                                            {% else %}
                                                                <td style="background-color:#e68484">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if distribution_multitask_values[distribution_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            {% endif %}
                                                        {% elif task_names[j] == 'VDss_Lombardo' %}
                                                            {% if preds[smiles_index][j] <= 30 %}

                                                                <td style="background-color:#8dec9c">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if distribution_multitask_values[distribution_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            
                                                            {% else %}
                                                                <td style="background-color:#e68484">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if distribution_multitask_values[distribution_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            {% endif %}
                                                        {% else %}
                                                            <td>
                                                                {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                {% if ranges[counter.value] != 'N/A' %} 
                                                                    <span 
                                                                        class="glyphicon glyphicon-exclamation-sign" 
                                                                        style="font-size:15px" data-toggle="tooltip" 
                                                                        data-placement="right" 
                                                                        title="{{ ranges[counter.value] }}">
                                                                    </span>
                                                                {% endif %}
                                                                {% if distribution_multitask_values[distribution_list.index(task_names[j])] < 0.6 %}
                                                                    <span 
                                                                        class="glyphicon glyphicon-warning-sign" 
                                                                        style="font-size:15px" data-toggle="tooltip" 
                                                                        data-placement="right" 
                                                                        title="Lower accuracy">
                                                                    </span>
                                                                {% endif %}
                                                            </td>

                                                        {% endif %}
                                                        
                                                        <td>
                                                            {{ '%0.2f'|format(drugbank_percentiles[smiles_index][j]) }}%
                                                        </td>
                                                        <td>
                                                            {{ prop_units[counter.value] }}
                                                            {% set counter.value = counter.value + 1 %}
                                                        </td>
                                                        
                                                    </tr>
                                                {% endif %}
                                            {% endfor %}
                                        </tbody>
                                        
                                    </table>
                                </div>

                                <div style="flex: 1; width: 100%;">
                                    <h3 id="table_header">Metabolism</h3>
                                    <table style="width: 90%; margin: 10px;">
                                        <thead>
                                            <tr>
                                                <th>Model</th>
                                                <th>Prediction</th>
                                                <th>DrugBank Percentile</th>
                                                <th>Unit</th>
                                               
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for j in range(num_tasks) %}
                                                {% if task_names[j] in metabolism_list %}
                                                    <tr>
                                                        <td><strong>
                                                            <a href={{ metabolism_urls[metabolism_list.index(task_names[j])] }} class="data_link">
                                                                {{ metabolism_names[metabolism_list.index(task_names[j])] }}
                                                            </a>
                                                            
                                                            <span 
                                                                class="glyphicon glyphicon-question-sign" 
                                                                style="font-size:15px" data-toggle="tooltip" 
                                                                data-placement="right" 
                                                                title="Dataset R^2 mean: {{ '%0.4g'|format(metabolism_multitask_values[metabolism_list.index(task_names[j])]) }}          
                                                                Dataset Size: {{ '%0.4g'|format(metabolism_size[metabolism_list.index(task_names[j])]) }}">
                                                            </span>    
                                                        </strong></td>                                                        
                                                        <td>
                                                            {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                            {% if ranges[counter.value] != 'N/A' %} 
                                                                <span 
                                                                    class="glyphicon glyphicon-exclamation-sign" 
                                                                    style="font-size:15px" data-toggle="tooltip" 
                                                                    data-placement="right" 
                                                                    title="{{ ranges[counter.value] }}">
                                                                </span>
                                                            {% endif %}
                                                            {% if metabolism_multitask_values[metabolism_list.index(task_names[j])] < 0.6 %}
                                                                <span 
                                                                    class="glyphicon glyphicon-warning-sign" 
                                                                    style="font-size:15px" data-toggle="tooltip" 
                                                                    data-placement="right" 
                                                                    title="Lower accuracy">
                                                                </span>
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            {{ '%0.2f'|format(drugbank_percentiles[smiles_index][j]) }}%
                                                        </td>
                                                        <td>
                                                            {{ prop_units[counter.value] }}
                                                            {% set counter.value = counter.value + 1 %}
                                                        </td>
                                                        
                                                    </tr>
                                                {% endif %}
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>

                                

                                <div style="flex: 1; width: 100%;">
                                    <h3 id="table_header">Excretion</h3>
                                    <table style="width: 90%; margin: 10px;">
                                        <thead>
                                            <tr>
                                                <th>Model</th>
                                                <th>Prediction</th>
                                                <th>DrugBank Percentile</th>
                                                <th>Unit</th>
                                                
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for j in range(num_tasks) %}
                                                {% if task_names[j] in excretion_list %}
                                                    <tr>
                                                        <td><strong>
                                                            <a href={{ excretion_urls[excretion_list.index(task_names[j])] }} class="data_link">
                                                                {{ excretion_names[excretion_list.index(task_names[j])] }}
                                                            </a>
                                                           
                                                            <span 
                                                                class="glyphicon glyphicon-question-sign" 
                                                                style="font-size:15px" data-toggle="tooltip" 
                                                                data-placement="right" 
                                                                title="Dataset R^2 mean: {{ '%0.4g'|format(excretion_multitask_values[excretion_list.index(task_names[j])]) }}          
                                                                Dataset Size: {{ '%0.4g'|format(excretion_size[excretion_list.index(task_names[j])]) }}">
                                                            </span>        
                                                        </strong></td>                                                        
                                                        <td>
                                                            {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                            {% if ranges[counter.value] != 'N/A' %} 
                                                                <span 
                                                                    class="glyphicon glyphicon-exclamation-sign" 
                                                                    style="font-size:15px" data-toggle="tooltip" 
                                                                    data-placement="right" 
                                                                    title="{{ ranges[counter.value] }}">
                                                                </span>
                                                            {% endif %}
                                                            {% if excretion_multitask_values[excretion_list.index(task_names[j])] < 0.6 %}
                                                                <span 
                                                                    class="glyphicon glyphicon-warning-sign" 
                                                                    style="font-size:15px" data-toggle="tooltip" 
                                                                    data-placement="right" 
                                                                    title="Lower accuracy">
                                                                </span>
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            {{ '%0.2f'|format(drugbank_percentiles[smiles_index][j]) }}%
                                                        </td>
                                                        <td>
                                                            {{ prop_units[counter.value] }}
                                                            {% set counter.value = counter.value + 1 %}
                                                        </td>
                                                        
                                                    </tr>
                                                {% endif %}
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>

                                <div style="flex: 1; width: 100%;">
                                    <h3 id="table_header">Toxicity</h3>
                                    <table style="width: 90%; margin: 10px;">
                                        <thead>
                                            <tr>
                                                <th>Model</th>
                                                <th>Prediction</th>
                                                <th>DrugBank Percentile</th>
                                                <th>Unit</th>
                                                
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for j in range(num_tasks) %}
                                                {% if task_names[j] in toxicity_list %}
                                                    <tr>
                                                        <td><strong>
                                                            <a href={{ toxicity_urls[toxicity_list.index(task_names[j])] }} class="data_link">
                                                                {{ toxicity_names[toxicity_list.index(task_names[j])] }}
                                                            </a>
                                                            <span 
                                                                class="glyphicon glyphicon-question-sign" 
                                                                style="font-size:15px" data-toggle="tooltip" 
                                                                data-placement="right" 
                                                                title="Dataset R^2 mean: {{ '%0.4g'|format(toxicity_multitask_values[toxicity_list.index(task_names[j])]) }}          
                                                                Dataset Size: {{ '%0.4g'|format(toxicity_size[toxicity_list.index(task_names[j])]) }}">
                                                            </span>    
                                                        </strong></td>
                                                        {% if task_names[j] == 'Carcinogens_Lagunin' %}
                                                            {% if preds[smiles_index][j] <= 0.3 %}

                                                                <td style="background-color:#8dec9c">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if toxicity_multitask_values[toxicity_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            
                                                            {% else %}
                                                                <td style="background-color:#e68484">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if toxicity_multitask_values[toxicity_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            {% endif %}
                                                        {% elif task_names[j] == 'DILI' %}
                                                            {% if preds[smiles_index][j] <= 0.3 %}

                                                                <td style="background-color:#8dec9c">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if toxicity_multitask_values[toxicity_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            
                                                            {% else %}
                                                                <td style="background-color:#e68484">
                                                                    {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                    {% if ranges[counter.value] != 'N/A' %} 
                                                                        <span 
                                                                            class="glyphicon glyphicon-exclamation-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="{{ ranges[counter.value] }}">
                                                                        </span>
                                                                    {% endif %}
                                                                    {% if toxicity_multitask_values[toxicity_list.index(task_names[j])] < 0.6 %}
                                                                        <span 
                                                                            class="glyphicon glyphicon-warning-sign" 
                                                                            style="font-size:15px" data-toggle="tooltip" 
                                                                            data-placement="right" 
                                                                            title="Lower accuracy">
                                                                        </span>
                                                                    {% endif %}
                                                                </td>
                                                            {% endif %}
                                                        
                                                        {% else %}
                                                            <td>
                                                                {{ '%0.4f'|format(preds[smiles_index][j]) }}
                                                                {% if ranges[counter.value] != 'N/A' %} 
                                                                    <span 
                                                                        class="glyphicon glyphicon-exclamation-sign" 
                                                                        style="font-size:15px" data-toggle="tooltip" 
                                                                        data-placement="right" 
                                                                        title="{{ ranges[counter.value] }}">
                                                                    </span>
                                                                {% endif %}
                                                                {% if toxicity_multitask_values[toxicity_list.index(task_names[j])] < 0.6 %}
                                                                    <span 
                                                                        class="glyphicon glyphicon-warning-sign" 
                                                                        style="font-size:15px" data-toggle="tooltip" 
                                                                        data-placement="right" 
                                                                        title="Lower accuracy">
                                                                    </span>
                                                                {% endif %}
                                                            </td>

                                                        {% endif %}
                                                        <td>
                                                            {{ '%0.2f'|format(drugbank_percentiles[smiles_index][j]) }}%
                                                        </td>
                                                        <td>
                                                            {{ prop_units[counter.value] }}
                                                            {% set counter.value = counter.value + 1 %}
                                                        </td>
                                                       
                                                    </tr>
                                                {% endif %}
                                                
                                            {% endfor %}
                                            <!-- <p>Further ToxCast and Tox21 Results avaliable via download</p> -->
                                            
                                        </tbody>
                                    </table>
                                </div>

                            </div>

                        </div>
                        <br>
                        
                        <script>
                            $(document).ready(function() {
                                // Fetch SMILES string
                                var smiles = "{{ smiles[smiles_index] }}";

                                // PUG-REST API URL
                                var pubChemUrl = `https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/smiles/${smiles}/cids/JSON`;

                                // Fetch PubChem link
                                $.getJSON(pubChemUrl, function(data) {
                                    if (data && data.IdentifierList && data.IdentifierList.CID.length > 0) {
                                        var cid = data.IdentifierList.CID[0];
                                        var pubChemLink = `<a href="https://pubchem.ncbi.nlm.nih.gov/compound/${cid}" target="_blank">View on PubChem</a>`;
                                        $("#pubchem-link{{ smiles_index }}").html(pubChemLink);
                                        var nameUrl = `https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/${cid}/property/common_name/JSON`;
                                
                                    }
                                    var imageDiv = document.getElementById("molecule-image{{ smiles_index }}");
                                    var imageUrl = `https://pubchem.ncbi.nlm.nih.gov/image/imagefly.cgi?cid=${cid}&width=300&height=300`;
                                    var imageElement = `<img src="${imageUrl}" alt="Molecule Image" width="150" height="150">`;
                                    imageDiv.innerHTML = imageElement;

                                    var imageDiv2 = document.getElementById("molecule-image2{{ smiles_index }}");
                                    var imageUrl2 = `https://pubchem.ncbi.nlm.nih.gov/image/imagefly.cgi?cid=${cid}&width=300&height=300`;
                                    var imageElement2 = `<img src="${imageUrl}" alt="Molecule Image" width="150" height="150">`;
                                    imageDiv2.innerHTML2 = imageElement2;
                                });
                            });
                        </script>
                    </li>    
                    {% endfor %}
            </ul>
              
            {% if show_more > 0 %}
                <p>... and {{ show_more }} more. Download file for full predictions.</p>
            {% endif %}
        {% endif %}

    </div>
</body>
{% endblock %}




